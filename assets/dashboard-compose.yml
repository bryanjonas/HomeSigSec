services:
  homesigsec-nginx:
    image: nginx:alpine
    restart: unless-stopped
    ports:
      # Bind dashboard to LAN + Tailscale explicitly by ip:port pairs.
      - "${HOMESIGSEC_LAN_BIND:-127.0.0.1:8090}:8090"
      - "${HOMESIGSEC_TS_BIND:-127.0.0.1:8091}:8090"
    volumes:
      - ./dashboard-nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ${HOMESIGSEC_WORKDIR:-./../output}/www:/www:ro
    depends_on:
      - homesigsec-api

  homesigsec-api:
    build:
      context: ./dashboard-api
    restart: unless-stopped
    environment:
      - HOMESIGSEC_WORKDIR=${HOMESIGSEC_WORKDIR:-/work/output}
    volumes:
      - ${HOMESIGSEC_WORKDIR:-./../output}:/work/output
