services:
  homesigsec-nginx:
    image: nginx:alpine
    restart: unless-stopped
    ports:
      # Bind dashboard explicitly by ip:port pair (set to a LAN or Tailscale interface as desired).
      - "${HOMESIGSEC_BIND:-127.0.0.1:8090}:8090"
    volumes:
      - ./dashboard-nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ${HOMESIGSEC_WORKDIR:-./../output}/www:/www:ro
    depends_on:
      - homesigsec-api

  homesigsec-api:
    build:
      context: ./dashboard-api
    restart: unless-stopped
    environment:
      - HOMESIGSEC_WORKDIR=${HOMESIGSEC_WORKDIR:-/work/output}
    volumes:
      - ${HOMESIGSEC_WORKDIR:-./../output}:/work/output

  homesigsec-eventbus:
    build:
      context: ./collector
    restart: unless-stopped
    environment:
      - HOMESIGSEC_WORKDIR=${HOMESIGSEC_WORKDIR:-/work/output}
      - KISMET_URL=${KISMET_URL}
      - KISMET_API_TOKEN=${KISMET_API_TOKEN}
      - KISMET_USER=${KISMET_USER}
      - KISMET_PASS=${KISMET_PASS}
    volumes:
      - ${HOMESIGSEC_WORKDIR:-./../output}:/work/output
